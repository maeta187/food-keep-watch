# リポジトリガイドライン

## 適用範囲

これらの指示はリポジトリ全体に適用されます。

## プロジェクト概要

- 本プロジェクトは TypeScript で記述された Expo Router React Native アプリです。
- スタイリングは `nativewind` を通じて Tailwind ユーティリティクラスを使用します。可能な限りインラインスタイルではなくユーティリティクラスを優先してください。

## 開発方針

- 品質・保守性・安全性を意識しつつ、プロジェクトのフェーズに応じた現実的な落としどころを選ぶ
- 発見した課題は放置せず対応するか、理由とともに記録する（ボーイスカウトルール）
- 妥協点と判断理由をドキュメント化し、コードレビューでは建設的なフィードバックを歓迎する
- チームや将来の開発者が理解しやすいよう、意図を共有する
- 振り返りから得た学びを次の開発へ活かし、改善を継続する

## 品質と保守性

- DRY 原則を守り、単一の信頼できる情報源を維持する
- 命名は意図が伝わる語を選び、一貫したコーディングスタイルを保つ
- コメントは「なぜ」を説明し、「何を」はコードに表現する
- 変更は小さく分割し、機能追加と併せて既存コードの改善を検討する
- 未使用コードや技術的負債は積極的に整理し、必要な場合は記録する
- 新しいツールや手法は価値とコストを評価した上で導入する

## エラーハンドリングと信頼性

- エラーは握りつぶさず根本原因を解消し、明確なメッセージで早期検出する
- 外部 API やネットワークは失敗を前提に設計し、テストでエラーケースもカバーする
- タイムアウトやリトライ（指数バックオフ）、サーキットブレーカーなどで耐障害性を高める
- ログやメトリクスを活用し、挙動を追跡できる状態を保つ

## セキュリティ

- 秘密情報は環境変数など安全な方法で管理し、外部入力は必ず検証する
- 必要最小限の権限で動作させ、セキュリティ診断ツールを定期的に実行する

## パフォーマンス

- 計測に基づいて最適化し、拡張性を意識した設計を行う
- 必要になるまでリソース読み込みを遅延させ、キャッシュや N+1 問題へ注意する

## デバッグ

- 再現手順を確立し、範囲を絞って調査する
- デバッガーやプロファイラーを適切に使い、調査の知見を共有する

## 依存関係の管理

- 追加は必要最小限とし、ライセンスやメンテナンス状況を確認する
- ロックファイルを管理し、アップデートはセキュリティ・互換性の観点で計画的に行う

## 言語方針

- アプリ内のユーザー向け文言および通知は当面日本語に固定し、日本語体験を優先的に整えます。
- 後から多言語化しやすいように、文言は `constants/ui-text.ts` などの定義ファイルで一元管理します。
- iOS のシステムUIを日本語化するため、`app.json` の `ios.supportedLocales` と `ios.infoPlist.CFBundleDevelopmentRegion` は `ja` を指定した状態を保ちます。

## 機能要件

- 賞味期限・消費期限を登録し、管理できること。
- 入力した情報は一覧またはカレンダー表示で確認できること（必要に応じて純正カレンダーアプリとの連携を検討する）。
- 登録時に通知時間を設定し、プッシュ通知で期限を知らせること。
- 食品カテゴリーを設け、分類して管理できること。
- データベースには Supabase を利用する。
- 対応プラットフォームは iOS のみとする。
- 初期段階では匿名ユーザーと端末固有IDで管理し、必要に応じてサインイン機能を追加する。

## このプロジェクトを開発する人について

- React と TypeScript による開発経験があり、Tailwind ユーティリティクラスやデザインシステムを意識した実装ができます。
- Expo と React Native には触れ始めた段階で、これらの技術領域でのサポートを必要としています。

## コードスタイル

- パッケージ管理とスクリプト実行は Bun を用い、`bun run` / `bunx` コマンドで統一してください。
- クラスコンポーネントではなくフックを用いた関数コンポーネントを基本とします。
- コンポーネントは小さく焦点を絞り、可読性が向上する場合は `/app` や隣接する `/index.ts` にヘルパーを抽出してください。
- props や state には TypeScript の型またはインターフェースを使用し、特に公開する関数やコンポーネントには明示的な型を付けてください。
- 非同期コードを変更する場合は生の Promise ではなく `async/await` を使用してください。
- 既に default export を使用しているファイルを除き、default export は新たに追加しないでください。
- コード整形は `bun run format`（Prettier）、静的解析は `bun run lint`（ESLint）を利用し、警告はコミット前に解消してください。

## アセットとスタイリング

- 新しい画像や静的アセットは `assets/` ディレクトリに配置し、ファイル名はケバブケースにしてください。
- Tailwind ユーティリティクラスを追加するときは、レイアウト・余白・タイポグラフィなど意味の近いものをまとめて記述してください。

## テストと検証

- 機能に影響する変更を加えた場合は、依存関係を変更したときに `bun install` を一度実行し、ローカル検証には `bunx expo start --web` を使用してください。
- ユニットテスト可能なロジックを追加した場合は、`.test.ts` サフィックスのテストファイルを近接配置してください。

## ドキュメントとコメント

- 重要なビジネスロジックには意図を簡潔に説明するコメントを付記してください。
- ユーザーに見える挙動が変化した場合は README やアプリ内ドキュメントを更新してください。

## Git と PR

- コミットメッセージは Gitmoji のガイドラインに従い、先頭に適切な絵文字を付けてください（参考: https://gitmoji.dev/ ）。
- 絵文字とコミットメッセージの間にはコロンを付けてください（例: 🎉: 機能を追加する）。
- コミットメッセージは現在形で書いてください（例: 「機能を追加する」）。
- 要約は簡潔にし、主な変更点に触れてください。
- 機能追加・バグ修正・リファクタリング・設定変更、Lint、フォーマットなど目的ごとにコミットを分け、混在させないでください。

## 言語に関する注意

- 指示はすべて日本語で記載されています。矛盾や疑問がある場合も日本語で確認してください。
- この環境で回答する際は、常に日本語で応答してください。
